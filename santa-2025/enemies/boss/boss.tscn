[gd_scene load_steps=26 format=3 uid="uid://dhh663hd246p3"]

[ext_resource type="Script" uid="uid://ckqgteahex3nn" path="res://enemies/Boss.gd" id="1_n18ml"]
[ext_resource type="Script" uid="uid://dyhp2nkv0oyxm" path="res://components/state_machine.gd" id="1_ubujh"]
[ext_resource type="PackedScene" uid="uid://brvcncdhx4gpu" path="res://components/entity_spawner.tscn" id="3_r4ron"]
[ext_resource type="Script" uid="uid://ciyvb0x1ucnxy" path="res://enemies/boss/states/boss_bullet_wave.gd" id="4_8d0e3"]
[ext_resource type="Script" uid="uid://c62d321qpdq1l" path="res://enemies/boss/states/boss_minions.gd" id="4_vsebo"]
[ext_resource type="Texture2D" uid="uid://b0k8hbdb5jtra" path="res://assets/boss/boss.png" id="5_2tiri"]
[ext_resource type="PackedScene" uid="uid://dnecco0xl2u5t" path="res://enemies/boss/defense/defence_breaker.tscn" id="5_b5n78"]
[ext_resource type="PackedScene" uid="uid://7apob1ku4abi" path="res://enemies/tank_melee/melee_enemy.tscn" id="6_opohk"]
[ext_resource type="PackedScene" uid="uid://4uclpbd0a7l1" path="res://enemies/enemy_bullet.tscn" id="8_2tiri"]
[ext_resource type="PackedScene" uid="uid://cw6vrpa8b0u16" path="res://components/hurtbox.tscn" id="9_2tiri"]
[ext_resource type="PackedScene" uid="uid://duvyp3fetud8o" path="res://enemies/boss/defense/bullet_defence.tscn" id="10_1s7ui"]
[ext_resource type="Texture2D" uid="uid://cjc87h01ouefr" path="res://assets/defence/defence.png" id="12_o8os0"]
[ext_resource type="PackedScene" uid="uid://dnomsvvnuwjes" path="res://components/flash.tscn" id="13_02fuc"]
[ext_resource type="Shader" uid="uid://bys66bmvlt136" path="res://shaders/flash.gdshader" id="14_m37od"]

[sub_resource type="CircleShape2D" id="CircleShape2D_1s7ui"]
radius = 100.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_2tiri"]
size = Vector2(51, 50)

[sub_resource type="Animation" id="Animation_1s7ui"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("boss_defence/Sprite2D:scale")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(2, 2)]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("boss_defence/Sprite2D:modulate")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 0.3647059)]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("boss_defence/Sprite2D:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("boss_defence/Sprite2D:frame")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("flash:material:shader_parameter/flash_amount")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("flash:visible")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_m37od"]
resource_name = "defence_broken"
length = 0.5
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("boss_defence/Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.049999997, 0.1, 0.15, 0.2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("boss_defence/Sprite2D:scale")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.45, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(2, 2), Vector2(0.5, 0.5)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("boss_defence/Sprite2D:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("flash:material:shader_parameter/flash_amount")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.25, 0.5),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [0.0, 1.0, 0.0]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("flash:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0, 0.25, 0.5),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 1,
"values": [false, true, false]
}

[sub_resource type="Animation" id="Animation_o8os0"]
resource_name = "defence_hit"
length = 0.2
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("boss_defence/Sprite2D:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.05, 0.2),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(2, 2), Vector2(2.5, 2.5), Vector2(2, 2)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("boss_defence/Sprite2D:modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.05, 0.2),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0.3647059), Color(1, 1, 1, 0.28235295), Color(1, 1, 1, 0.3647059)]
}

[sub_resource type="Animation" id="Animation_b0wi3"]
resource_name = "defence_off"
length = 0.3
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("boss_defence/Sprite2D:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.25),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(2, 2), Vector2(1.5, 1.5), Vector2(0.5, 0.5)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("boss_defence/Sprite2D:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.25),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}

[sub_resource type="Animation" id="Animation_02fuc"]
resource_name = "defence_on"
length = 0.3
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("boss_defence/Sprite2D:visible")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.05),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [false, true]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("boss_defence/Sprite2D:scale")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.3),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(0.5, 0.5), Vector2(1.5, 1.5), Vector2(2, 2)]
}

[sub_resource type="Animation" id="Animation_b5n78"]
resource_name = "spawn_bullet"
length = 1.7
loop_mode = 2
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6, 0.8, 1, 1.2, 1.4, 1.6),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [0.0, 0.7853982, 1.5707964, 2.3561945, 3.1415927, 3.9269907, 4.712389, 5.846853, 6.2831855]
}

[sub_resource type="Animation" id="Animation_2tiri"]
resource_name = "spawn_minion"
length = 0.5
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.4),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(1, 1), Vector2(0.8, 0.8), Vector2(1, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_1s7ui"]
_data = {
&"RESET": SubResource("Animation_1s7ui"),
&"defence_broken": SubResource("Animation_m37od"),
&"defence_hit": SubResource("Animation_o8os0"),
&"defence_off": SubResource("Animation_b0wi3"),
&"defence_on": SubResource("Animation_02fuc"),
&"spawn_bullet": SubResource("Animation_b5n78"),
&"spawn_minion": SubResource("Animation_2tiri")
}

[sub_resource type="ShaderMaterial" id="ShaderMaterial_p1sap"]
shader = ExtResource("14_m37od")
shader_parameter/flash_color = Color(0.36862746, 0.003921569, 0.10980392, 1)
shader_parameter/flash_amount = 0.0

[node name="Boss" type="CharacterBody2D"]
script = ExtResource("1_n18ml")

[node name="boss_defence" parent="." node_paths=PackedStringArray("collision_") instance=ExtResource("10_1s7ui")]
collision_mask = 0
collision_ = NodePath("CollisionShape2D")

[node name="CollisionShape2D" type="CollisionShape2D" parent="boss_defence"]
shape = SubResource("CircleShape2D_1s7ui")
disabled = true
debug_color = Color(0, 0.64829797, 0.19764718, 0.41960785)

[node name="Sprite2D" type="Sprite2D" parent="boss_defence"]
modulate = Color(1, 1, 1, 0.3647059)
scale = Vector2(2, 2)
texture = ExtResource("12_o8os0")
hframes = 5

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]

[node name="state_machine" type="Node2D" parent="CollisionShape2D" node_paths=PackedStringArray("initial_state")]
visible = false
script = ExtResource("1_ubujh")
initial_state = NodePath("bossMinion")
metadata/_custom_type_script = "uid://dyhp2nkv0oyxm"

[node name="bossBulletWave" type="Node" parent="CollisionShape2D/state_machine" node_paths=PackedStringArray("bullet_spawner", "hurtbox", "owner_node", "animation_player")]
script = ExtResource("4_8d0e3")
bullet_spawner = NodePath("../../../entity_spawner")
hurtbox = NodePath("../../../Sprite2D/hurtbox")
spawn_cooldown = 0.04
owner_node = NodePath("../../..")
animation_player = NodePath("../../../AnimationPlayer")
metadata/_custom_type_script = "uid://ciyvb0x1ucnxy"

[node name="bossMinion" type="Node" parent="CollisionShape2D/state_machine" node_paths=PackedStringArray("minion_spawner", "defence", "breaker_spawn_cooldown", "defence_cooldown", "owner_node", "animation_player")]
script = ExtResource("4_vsebo")
minion_spawner = NodePath("../../../entity_spawner")
defence_breaker_load = ExtResource("5_b5n78")
defence = NodePath("../../../boss_defence")
breaker_spawn_cooldown = NodePath("../../../breaker_spawn_cooldown")
defence_cooldown = NodePath("../../../defence_cooldown")
minion_spawn_cooldown = 3
owner_node = NodePath("../../..")
animation_player = NodePath("../../../AnimationPlayer")
metadata/_custom_type_script = "uid://c62d321qpdq1l"

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("5_2tiri")

[node name="hurtbox" parent="Sprite2D" node_paths=PackedStringArray("owner_node") instance=ExtResource("9_2tiri")]
collision_layer = 4
max_hp = 25
owner_node = NodePath("../..")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Sprite2D/hurtbox"]
position = Vector2(-0.5, 0)
shape = SubResource("RectangleShape2D_2tiri")

[node name="entity_spawner" parent="." node_paths=PackedStringArray("father") instance=ExtResource("3_r4ron")]
load_bullet = ExtResource("8_2tiri")
minion = ExtResource("6_opohk")
alpha = 3.0
father = NodePath("../Sprite2D")

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="health_bar" type="ProgressBar" parent="CanvasLayer"]
offset_right = 474.0
offset_bottom = 27.0
max_value = 25.0
show_percentage = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_1s7ui")
}

[node name="defence_cooldown" type="Timer" parent="."]
wait_time = 5.0
one_shot = true

[node name="breaker_spawn_cooldown" type="Timer" parent="."]
wait_time = 3.0
one_shot = true

[node name="flash" parent="." instance=ExtResource("13_02fuc")]
visible = false
material = SubResource("ShaderMaterial_p1sap")
color = Color(1, 1, 1, 0.4745098)

[node name="audio" type="Node2D" parent="."]

[node name="hit" type="AudioStreamPlayer2D" parent="audio"]

[connection signal="hit" from="boss_defence" to="CollisionShape2D/state_machine/bossMinion" method="_on_boss_defence_hit"]
[connection signal="got_hit" from="Sprite2D/hurtbox" to="." method="_on_hurtbox_got_hit"]
[connection signal="got_hit" from="Sprite2D/hurtbox" to="CollisionShape2D/state_machine/bossBulletWave" method="_on_hurtbox_got_hit"]
[connection signal="timer_finished" from="entity_spawner" to="CollisionShape2D/state_machine/bossBulletWave" method="_on_bullet_spawner_timer_finished"]
[connection signal="timer_finished" from="entity_spawner" to="CollisionShape2D/state_machine/bossMinion" method="_on_bullet_spawner_timer_finished"]
[connection signal="timeout" from="defence_cooldown" to="CollisionShape2D/state_machine/bossMinion" method="_on_defence_cooldown_timeout"]
[connection signal="timeout" from="breaker_spawn_cooldown" to="CollisionShape2D/state_machine/bossMinion" method="_on_breaker_spawn_cooldown_timeout"]
